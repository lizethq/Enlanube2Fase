<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <report
            id="report_custom_account_purchase_invoice"
            string="Factura Compra"
            model="account.move"
            report_type="qweb-pdf"
            name="reports_account_thomas.report_custom_template_account_purchase_invoice"
        />

        <record id="paperformat_low_monthly_report_account_purchase_invoice" model="report.paperformat">
            <field name="name">Formato de papel factura compra</field>
            <field name="default" eval="True"/>
            <field name="format">A4</field>
            <field name="page_height">0</field>
            <field name="page_width">0</field>
            <field name="orientation">Portrait</field>
            <field name="margin_top">50</field>
            <field name="margin_bottom">30</field>
            <field name="margin_left">13</field>
            <field name="margin_right">13</field>
            <field name="header_line" eval="False"/>
            <field name="header_spacing">40</field>
            <field name="dpi">90</field>
        </record>

        <template id="report_custom_template_account_purchase_invoice">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">                    
                    <div class="header" style="margin: 0px -15px;">
						<img t-att-src="'data:image/png;base64,%s' % to_text(o.company_id.logo)" width="150" height="60"/> 
						<br />
						<div style="border-bottom: 1px solid black; margin-top: 5px;"/> 
						<span t-field="o.company_id.partner_id" /> <br />
                        <t t-if="o.company_id.vat"> NIT: <span t-field="o.company_id.vat" /> <br /> </t>
						<t t-if="o.company_id.street"> <span t-field="o.company_id.street" /> <br /> </t>                        
						<t t-if="o.company_id.phone"> <span t-field="o.company_id.phone" /> </t>
                    </div>
                    <div class="article o_report_layout_standard">
                        <div class="page">							
                            <style>
                                th, td{
                                    padding: 0px;
                                    font-size: 10pt;                                    
                                    border: 1px solid #000;
                                }                                                                                        
                                table{
                                    width: 100%;
                                    border: 1px solid #000;
                                    border-spacing: 0px;
                                }                                
                                th{
                                    text-align: center;
                                }
                                .container{
                                    margin: 0px;
                                    padding: 0px;
                                }
                                td{
                                    padding: 0px 5px;
                                }
                            </style>     
                            <table width="100%">
                                <tr>
                                    <th style="background-color:#CBCBCB; text-align:center; vertical-align: middle;">DATOS DEL TERCERO</th>
                                    <th style="background-color:#CBCBCB; text-align:center; vertical-align: middle;" colspan="2">FACTURA</th>
                                </tr>
                                <tr>
                                    <td rowspan="2" valign="middle" align="left" style="padding-left: 5px;">
                                        Razón Social o Nombre: <span style="margin-left: 20px;" t-field="o.line_ids[-1].partner_id.name" /><br />
                                        NIT: <span style="margin-left: 130px;" t-field="o.line_ids[-1].partner_id.identification_document" /> <br />
                                        Dirección: <span style="margin-left: 95px;" t-field="o.line_ids[-1].partner_id.complete_adress_dian" /> <br />
                                        Ciudad: <span style="margin-left: 110px;" t-field="o.line_ids[-1].partner_id.city_id" /> <br />
                                        Télefono: <span style="margin-left: 100px;" t-field="o.line_ids[-1].partner_id.phone" />  
                                    </td>
                                    <td colspan="2" style="vertical-align: middle;">
                                        <p style="text-align: center; font-weight: bold; font-size: 20pt;">
                                            <span t-field="o.name" />
                                        </p>
                                    </td>
                                </tr>	
                                <tr>
                                    <td colspan="2" style="vertical-align: middle;">
                                        <p style="text-align: center;">
                                            <span t-field="o.journal_id" />
                                        </p>
                                    </td>
                                </tr>                                  
                                <tr>
                                    <th style="background-color:#CBCBCB; text-align: center;"><strong>DATOS DEL PAGO</strong></th>
                                    <th style="background-color:#CBCBCB; text-align: center;"><strong>FECHA CONTABLE</strong></th>
                                    <th style="background-color:#CBCBCB; text-align: center;"><strong>FECHA DOCUMENTO</strong></th>
                                </tr>
                                <tr>
                                    <td rowspan="3" valign="middle" align="left" style="padding-left: 5px;" width="65%">    										
                                        <div class="container">
                                            <div class="row">
                                                <div class="col-4">
                                                    Concepto: <br />
                                                    Metodo de pago: <br />
                                                    Moneda: <br />
                                                    Tasa de Cambio:													
                                                </div>
                                                <div class="col-8">
                                                    <span t-field="o.cost_description" /><br />
                                                    <span t-field="o.payment_mean_id" /> <br />
                                                    <span t-field="o.currency_id" /> <br />
                                                    <span t-esc="'{0:,.2f}'.format(o.currency_rate_raw)" />										
                                                </div>
                                            </div>
                                        </div>
                                    </td>                                
                                    <td style="text-align: center;"><span t-field="o.date" /></td> 
                                    <td style="text-align: center;"><span t-field="o.invoice_date"/>  </td>
                                </tr>
                                <tr>
                                    <th style="background-color:#CBCBCB; text-align: center; font-weight: bold;" colspan="2">REFERENCIA/FACTURA</th>
                                </tr>
                                <tr>
                                    <td style="text-align: center;" colspan="2"><span t-field="o.ref" /></td>
                                </tr>
                            </table> 
                            
                            <table width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#000000">
                                <thead>                        
                                    <tr>
                                        <th colspan="6" valign="middle" style="background-color:#CBCBCB; text-align: center;"><strong>POSICIONES DOCUMENTO CONTABLE</strong></th>
                                    </tr>
                                    <tr>
                                        <th style="text-align: center; background-color: #eeeeee;"><strong>CUENTA</strong></th>
                                        <th style="text-align: center; background-color: #eeeeee;"><strong>DESCRIPCIÓN</strong></th>
                                        <th style="text-align: center; background-color: #eeeeee;"><strong>NIT</strong></th>
                                        <th style="text-align: center; background-color: #eeeeee;"><strong>ORD/C. ANALÍTICA</strong></th>
                                        <th style="text-align: center; background-color: #eeeeee;"><strong>IMP. MON DOC</strong></th>
                                        <th style="text-align: center; background-color: #eeeeee;"><strong>IMP. MON LOC</strong></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-set="MonLoc" t-value="0" />
                                    <t t-set="valueInLetters" t-value="0" />
                                    <t t-foreach="o.line_ids" t-as="i">	    
                                        <t t-set="MonLoc" t-value="i.debit - i.credit" />                                
                                        <t t-if="i.account_id.user_type_id.name == 'A pagar' or i.account_id.user_type_id.name == 'Payable'">
                                            <t t-if="i.amount_currency == 0">
                                                <t t-if="i.debit == 0">
                                                    <t t-set="valueInLetters" t-value="valueInLetters + i.credit" />
                                                </t>
                                                <t t-else="">
                                                    <t t-set="valueInLetters" t-value="valueInLetters + i.debit" />
                                                </t>    
                                            </t>
                                            <t t-else="">
                                                <t t-set="valueInLetters" t-value="valueInLetters + i.amount_currency" />
                                            </t>
                                        </t>
                                        <tr>
                                            <td><span t-field="i.account_id.code" /></td>
                                            <td><span t-field="i.account_id.name" /></td>
                                            <td><span t-field="i.partner_id.identification_document" /></td>
                                            <td style="text-align: center;"><span t-field="i.analytic_account_id.code" /></td>
                                            <td t-if="i.amount_currency != 0"><span t-field="i.amount_currency" /></td>
                                            <td t-if="i.amount_currency == 0"><t t-esc="MonLoc" t-options="{'widget': 'monetary', 'display_currency': o.company_id.currency_id}" /></td>
                                            <td style="text-align: right;"><t t-esc="MonLoc" t-options="{'widget': 'monetary', 'display_currency': o.company_id.currency_id}" /></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                            <br/>
                            <t t-if="valueInLetters != 0">
                                <t t-if="valueInLetters &lt; 0" t-set="valueInLetters" t-value="valueInLetters * -1" />
                                <strong style="font-size: 10pt;">Total en letras:</strong>  
                                <span style="font-size: 10pt;" t-if="o.currency_id.name == 'COP'" t-esc="o.currency_id.amount_to_text(valueInLetters).replace('Peso', 'Pesos').replace('Cents', 'Centavos')" />
                                <span style="font-size: 10pt;" t-if="o.currency_id.name == 'USD' and 'es' in user.lang" t-esc="o.currency_id.amount_to_text(valueInLetters).replace('Dollars', 'Dólares').replace('Cents', 'Centavos')" />   
                                <span style="font-size: 10pt;" t-if="o.currency_id.name == 'USD' and 'en' in user.lang" t-esc="o.currency_id.amount_to_text(valueInLetters)" />
                            </t>
                            <br/>                        
						    <t t-set="taxes" t-value="o.taxes()" />
                        
                            <table width="100%" border="1" cellpadding="0" cellspacing="0" bordercolor="#000000">
                                <thead>                        
                                    <tr>
                                        <th style="text-align: center; background-color: #CBCBCB;" colspan="4">IMPUESTOS PRACTICADOS</th>
                                    </tr>
                                    <tr>
                                        <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">DESCRIPCIÓN</th>
                                        <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">%</th>
                                        <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">BASE</th>
                                        <th style="text-align: center; font-weight: bold; background-color: #CBCBCB;">VR. IMPUESTOS</th>
                                    </tr>
                                </thead>
                                <tbody>                            
                                    <t t-foreach="range(len(taxes['name']))" t-as="i">
                                        <tr>                                        
                                            <td><span t-esc="taxes['name'][i]" /></td>
                                            <td style="text-align: center;"><span t-esc="taxes['tax_percentage'][i]" /></td>
                                            <td style="text-align: right;"><span t-esc="taxes['product_value'][i]" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" /></td> 
                                            <td style="text-align: right;"><t t-esc="taxes['tax_value'][i]" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}"/>  </td> 
                                        </tr>                                    
                                    </t>
                                </tbody>                           
                                <tr>
                                    <td style="border: none;"></td>
                                    <td style="border: none;"></td>
                                    <td style="text-align: right; font-weight: bold; border: none; border-right: 1px solid;">Total impuestos</td>
                                    <td style="text-align: right; border: none;"><span t-esc="taxes['total_retained']" t-options="{'widget': 'monetary', 'display_currency': o.currency_id}" /></td>
                                </tr>                                                     
                            </table>
                        </div>                   
                    </div>

                    <div class="footer" style="margin: 0px -15px;">
                        <style>                            
                            table{
                                margin: 0;
                                padding: 0;
                                width: 100%;
                                border: 1px solid #000;
                                border-spacing: 0px;
                            
                            }                            
                            #text_footer{
                                font-size: 10pt;
                            }
                        </style>
                        <div id="text_footer">
                            <table>
                                <tr>
                                    <td align="center" style="padding-top: 40px;">
                                        <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                        <t t-set="cont" t-value="1" />
                                        <t t-foreach="o.message_ids" t-as="i">      
                                            <t t-if="cont == 1">
                                                Elaboro: <span style="text-align: center;" t-field="i.author_id" />    
                                            </t>
                                            <t t-set="cont" t-value="cont + 1" />
                                        </t>
                                    </td>
                                    <td align="center" style="padding-top: 40px;">
                                        <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                        <span style="text-align: center;">Autorizado por</span>
                                    </td>
                                    <td align="center" style="padding-top: 40px;">
                                        <hr width="90%" color="black" style="padding: 0; margin-bottom: 0;" />
                                        VoBo. Tesorería
                                    </td>                                    
                                </tr>
                            </table>
                            Imprimió: <span t-field="user.name" />  <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%d.%m.%Y %H:%M:%S')" />
                        </div>
                    </div>
                </t>
            </t>    
        </template>
    </data>
</odoo>
